# RHS333 (unofficial)  

# Important Topics for the Exam  
- DNS + DNSSEC  
- Kerberos  
- SSH  
- NFS  
- OpenSSL  
- Sendmail  
- Postfix  
- HTTPS  

# Lecture 2  

## Iptables (Lab 2.1)   
### Create a new custom chain  
```bash
# iptables -N <chain_name>  
```  
  
### Make sure all incoming traffic is processed by <chain_name> before it is processed by RH-Firewall-1-INPUT  
```bash
# iptables -I INPUT 1 -j <chain_name>  
```  
  
### Save your work  
```bash
# service iptables save
```  
  
### Create a new custom chain editing ```/etc/sysconfig/iptables``` directly  
```bash
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [1960:4012004]
:RH-Firewall-1-INPUT - [0:0]
:RHS333 - [0:0]
-A INPUT -j RHS333
-A INPUT -j RH-Firewall-1-INPUT
-A FORWARD -j RH-Firewall-1-INPUT
<reglas a completar despues>
```  
  
### Current observations  
- RH-Firewall-1-INPUT is 'lost', _no clue_ where the fuck it goes, but it disappears from ```iptables -L -v -n``` and ```/etc/sysconfig/iptables```.  
- Above might be due to incorrect or inconsistent /etc/sysconfig/iptables
  configuration.  

  

## TCP Wrappers (Lab 2.2)  
### Make sure that telnet-server and xinetd are installed _and_ enabled  
(The package ```telnet-server``` should pull both ```telnet-server``` and ```xinetd```)  
```bash
# yum install telnet-server
# chkconfig xinetd on
# chkconfig telnet on
# service xinetd start
```  

### Open up port ```23/tcp``` so that anyone on the network can connect to it  
```bash
# iptables -A RHS333 -p tcp --dport 23 -j ACCEPT
```  
Verify that the setting is correct via ```iptables -vnL```.  

### Create the ```/var/mesg/``` directory and the executable file ```/var/mesg/deny```  
```bash
# mkdir -p /var/mesg
# touch /var/mesg/deny
```  

Edit the ```/var/mesg/deny``` as follows:  
```bash
#!/bin/bash
echo "External connection refused at $(/bin/date)"
```  

### Modify the ```/etc/hosts.deny``` file so that the ```/var/mesg/deny``` script is run instead of ```in.telnetd``` for all telnet connections from outside the local network  
```bash
# echo "in.telnetd : ALL : twist /var/mesg/deny" >> /etc/hosts.deny
```  

### Modify the ```/etc/hosts.allow``` file to allow telnet connections from the example.com network (192.168.0/24) and the localhost network (127/8)  
```bash
# echo "in.telnetd : 192.168.0. 127." >> /etc/hosts.allow
```  

### Current observations  
None so far  

## xinetd SENSOR traps (Lab 2.3) 
### Verify that telnet is enabled and working  
```bash
# telnet <server>
```  

### Open the ```rlogin``` port ```(513/tcp)```  
```bash
# iptables -A RHS333 -p tcp --dport 513 -j ACCEPT
```  

### Install the ```rsh-server``` package  
```bash
# yum install rsh-server
```  
  
Edit the /etc/xinetd.d/rlogin file to include the following:
```text
service login
{
	flags		= SENSOR
	deny_time	= 2
	socket_type	= stream
	wait		= no
	user		= root
	server		= /bin/false
}
```  

And reload the ```xinetd``` service.  
```bash
# service xinetd restart
```  

### Observations  
- How can an attacker use a sensor trap against you ?  
Denial of Service Attack.  

## Understanding file context (Lab 2.4)  
- Moving keeps SELinux file contexts untouched  
- Copying replaces the SELinux file contexts with the ones corresponding to the
  user making the copy  
   
To restore the contexts of a file or directory, use ```restorecon```:  
```bash
# restorecon -FRvv /path/to/file
```  

# Lecture 3  




